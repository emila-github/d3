<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style type="text/css">

        .bubble{border: #80ff80 solid 1px;}
    </style>
    <script src="js/d3.js"></script>
    <script src="js/jquery.js"></script>
</head>
<body>

<script>
    $(document).ready(function () {

        var dataArray = [
            {
                name: '搜索引擎',
                uv: 38219419,
                percent: 50
            },
            {
                name: '直接访问',
                uv: 51449901,
                percent: 33.23
            },
            {
                name: '传统网站',
                uv: 6546523,
                percent: 10.2
            },
            {
                name: '手机网站',
                uv: 132156,
                percent: 13
            },
            {
                name: '导航网站',
                uv: 5456978,
                percent: 14
            },
            {
                name: '游戏厂商',
                uv: 14578,
                percent: 15
            },
            {
                name: '游戏周边',
                uv: 145668,
                percent: 16
            },
            {
                name: '客户端',
                uv: 59682,
                percent: 17
            }
        ];

        function showToolTip(pMessage,pX,pY,pShow) {
            if (typeof(tooltipDivID)=="undefined") {
                tooltipDivID =$('<div id="messageToolTipDiv" style="position:absolute;display:block;z-index:10000;border:2px solid black;background-color:rgba(0,0,0,0.8);margin:auto;padding:3px 5px 3px 5px;color:white;font-size:12px;font-family:arial;border-radius: 5px;vertical-align: middle;text-align: left;min-width:50px;overflow:auto;"></div>');

                $('body').append(tooltipDivID);
            }
            if (!pShow) { tooltipDivID.hide(); return;}
            //MT.tooltipDivID.empty().append(pMessage);
            tooltipDivID.html(pMessage);
            tooltipDivID.css({top:pY,left:pX});
            tooltipDivID.show();
        }


        var datas = dataArray;
        var diameter = 600 - 30,
                color = d3.scale.category20();  //返回长度为20的颜色数组，并根据传入的参数返回颜色，参数相同分配相同颜色
//        color = d3.scale.category20b();
        var bubble = d3.layout.pack() //用递归的圆环表现一个多层级布局.
                .sort(null)
                .size([diameter, diameter])
                .padding(10);

        var dobj=[],
                uvArr = [],
                averageUv = (function() {
                    var len = datas.length,
                            total = 0;
                    for(var i = 0; i < len; i++) {
                        total += datas[i]['uv'];
                    }
                    return total / len;
                })();
        for (var di=0;di<datas.length;di++) {
            var _val = averageUv > datas[di]['uv'] ? averageUv : datas[di]['uv'];
            dobj.push({"key":di,"value":_val});
        }


        var svg = d3.select('#svgId')
                .attr("class", "bubble")
                .attr('width', 800)
                .attr('height', 800);
        var root = {children: dobj};

        var node = svg.selectAll('.node')
                        .data(bubble.nodes(root)
                                .filter(function(d) { return !d.children; }))
                        .enter().append("g")
                        .attr("class", "node")
                        .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
                        .style("fill", function(d) { return color(datas[d.key]['name']); })
                        .on("mouseover", function(d,i) {
                            //console.log(d, i);
                            d3.select(this).style("fill", "gold");
                            var _pMsg = datas[d.key]['name'] + '<br\/>UV: ' + datas[d.key]['uv'] + '<br\/>占比: ' + datas[d.key]['percent'] + ' %';
                            showToolTip(_pMsg, d.x+d3.mouse(this)[0]+50, d.y+d3.mouse(this)[1], true);
                        })
                        .on("mousemove", function(d,i) {
                            tooltipDivID.css({top:d.y+d3.mouse(this)[1],left:d.x+d3.mouse(this)[0]+50});
                        })
                        .on("mouseout", function(d,i) {
                            //console.log(datas[d.key]['name'], color(datas[d.key]['name']));
                            d3.select(this).style("fill", function(d) { return color(datas[d.key]['name']); });
                            showToolTip(' ',0,0,false);
                        })
                ;


        //创建坐标系
        //scale()是坐标转换函数
        var xScale = d3.scale.linear()   //创建可视范围的方法
                .domain([20, 50]) //input domain
                .range([0, 800]); //output range


        //console.log(xScale(20));

        var yScale = d3.scale.linear()   //创建可视范围的方法
                .domain([160, 190]) //input domain
                .range([0, 800]); //output range

        node.append("circle")
//            .attr('cx', function(d) {return xScale(d.age) })
//            .attr('cy', function(d) {return yScale(d.height) })
            //.style("fill", '#ff7f0e')
                .attr('r', function(d) {return d.r;})
        ;
//
        node.append("text")
                .attr("dy", ".3em")
                .style("text-anchor", "middle")
                .style("fill","black")
                .text(function(d) { return datas[d.key]['name']; });
    });

</script>


<svg id="svgId"></svg>



</body>
</html>